<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>Spin Kelompok</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background: url('background.jpg') no-repeat center center fixed;
      background-size: cover;
      color: #fff;
      text-align: center;
      min-height: 100vh;
    }

    body::before {
      content: "";
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.55);
      z-index: -1;
    }

    h1 {
      margin-top: 20px;
    }

    canvas {
      display: block;
      margin: 20px auto;
    }

    button {
      padding: 12px 25px;
      font-size: 16px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-weight: bold;
    }

    .groups {
      display: flex;
      justify-content: center;
      gap: 15px;
      flex-wrap: wrap;
      margin: 20px;
    }

    .group {
      background: rgba(255,255,255,0.9);
      color: #000;
      padding: 10px;
      width: 200px;
      border-radius: 10px;
      text-align: left;
    }

    .group b {
      display: block;
      margin-bottom: 5px;
    }
  </style>
</head>

<body>

<h1>ðŸŽ¡ Spin Pembagian Kelompok</h1>
<p>3 Kelompok â€¢ Nama hilang setelah masuk</p>

<canvas id="wheel" width="350" height="350"></canvas>
<button onclick="spin()">SPIN</button>

<div class="groups">
  <div class="group"><b>Kelompok 1 (5)</b><ul id="k1"></ul></div>
  <div class="group"><b>Kelompok 2 (5)</b><ul id="k2"></ul></div>
  <div class="group"><b>Kelompok 3 (4)</b><ul id="k3"></ul></div>
</div>

<script>
let names = [
  "Anisa Apriliyanti",
  "Anisa Syifa Febriani",
  "Afwa Mumtajah",
  "Chairul Fatkan",
  "Eni Aisah Fitri",
  "Fadliatul Najiah",
  "Hasan Amirul Mulya",
  "Hazria Ahdayani",
  "Meila Anjani",
  "Syahrul Maulana Yusuf",
  "Siti Nuraeni",
  "Winda",
  "Fathur Febriansyah",
  "M. Hafidz"
];

let groups = [
  { id: "k1", max: 5, label: "Kelompok satu" },
  { id: "k2", max: 5, label: "Kelompok dua" },
  { id: "k3", max: 4, label: "Kelompok tiga" }
];

let currentGroup = 0;

const canvas = document.getElementById("wheel");
const ctx = canvas.getContext("2d");
let angle = 0;

const clickSound = new Audio("https://actions.google.com/sounds/v1/cartoon/wood_plank_flicks.ogg");
const popSound   = new Audio("https://actions.google.com/sounds/v1/cartoon/pop.ogg");

function speak(text) {
  let u = new SpeechSynthesisUtterance(text);
  u.lang = "id-ID";
  speechSynthesis.speak(u);
}

function drawWheel() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  if (names.length === 0) return;

  const r = canvas.width / 2;
  const slice = (2 * Math.PI) / names.length;
  const colors = ["#4CAF50", "#2196F3", "#FFC107", "#F44336"];

  names.forEach((name, i) => {
    ctx.beginPath();
    ctx.fillStyle = colors[i % colors.length];
    ctx.moveTo(r, r);
    ctx.arc(r, r, r, angle + i * slice, angle + (i + 1) * slice);
    ctx.fill();

    ctx.save();
    ctx.translate(r, r);
    ctx.rotate(angle + (i + 0.5) * slice);
    ctx.textAlign = "right";
    ctx.fillStyle = "#fff";
    ctx.font = "14px Arial";
    ctx.fillText(name, r - 10, 5);
    ctx.restore();
  });
}

function spin() {
  if (names.length === 0) {
    alert("Semua sudah masuk kelompok ðŸŽ‰");
    return;
  }

  if (document.getElementById(groups[currentGroup].id).children.length >= groups[currentGroup].max) {
    currentGroup++;
  }
  if (currentGroup >= groups.length) return;

  clickSound.play();

  let spinAngle = Math.random() * 2000 + 2000;
  let duration = 2000;
  let start = null;

  function animate(t) {
    if (!start) start = t;
    angle += spinAngle / duration * 0.016;
    drawWheel();

    if (t - start < duration) {
      requestAnimationFrame(animate);
    } else {
      let slice = (2 * Math.PI) / names.length;
      let index = Math.floor((2 * Math.PI - (angle % (2 * Math.PI))) / slice) % names.length;
      let chosen = names.splice(index, 1)[0];

      popSound.play();
      speak(chosen + " masuk " + groups[currentGroup].label);

      let li = document.createElement("li");
      li.textContent = chosen;
      document.getElementById(groups[currentGroup].id).appendChild(li);

      drawWheel();
    }
  }

  requestAnimationFrame(animate);
}

drawWheel();
</script>

</body>
</html>
